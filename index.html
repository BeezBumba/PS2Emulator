<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <link rel="icon" href="/favicon.ico"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="description" content="A PlayStation2 emulator for web browsers"/>
    <link rel="apple-touch-icon" href="/play-192.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <title>Play!.js</title>
    <script defer src="/static/js/main.caabe80b.js"></script>
    <script defer src="/register.js"></script>
    <link href="/static/css/main.5a525eca.css" rel="stylesheet">
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #000; /* matches theme */
        display: flex;
        justify-content: center;
        align-items: center;
      }

  .canvas-wrapper {
  position: relative;
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #000;
  overflow: hidden; /* ensures no accidental scrollbars */
}

.canvas-wrapper canvas {
  width: 90vw;   /* slightly smaller than full width */
  height: 90vh;  /* slightly smaller than full height */
  object-fit: contain; /* preserves aspect ratio */
  display: block;
}
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div class="global-row">
      <div class="global-column">
        <div class="canvas-wrapper">
          <canvas id="outputCanvas" width="640" height="480" tabindex="-1"></canvas>
        </div>
        <div id="root"></div>
      </div>
    </div>
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const keyMap = {
    // D-Pad
    12: "ArrowUp",    // DPad Up
    13: "ArrowDown",  // DPad Down
    14: "ArrowLeft",  // DPad Left
    15: "ArrowRight", // DPad Right

    // Face buttons
    2: "KeyA",        // Square → A
    0: "KeyZ",        // Cross → Z
    3: "KeyS",        // Triangle → S
    1: "KeyX",        // Circle → X

    // Start / Select
    9: "Enter",       // Start
    8: "Backspace",   // Select

    // Shoulder / Triggers
    4: "Digit1",      // L1
    6: "Digit2",      // L2
    10: "Digit3",     // L3
    5: "Digit8",      // R1
    7: "Digit9",      // R2
    11: "Digit0",     // R3
  };

  // Analog stick mapping
  function handleAxes(axes) {
    // Left stick → F/H (x-axis), T/G (y-axis)
    if (axes[0] < -0.5) sendKey("KeyF", true);
    else if (axes[0] > 0.5) sendKey("KeyH", true);
    else { sendKey("KeyF", false); sendKey("KeyH", false); }

    if (axes[1] < -0.5) sendKey("KeyT", true);
    else if (axes[1] > 0.5) sendKey("KeyG", true);
    else { sendKey("KeyT", false); sendKey("KeyG", false); }

    // Right stick → J/L (x-axis), I/K (y-axis)
    if (axes[2] < -0.5) sendKey("KeyJ", true);
    else if (axes[2] > 0.5) sendKey("KeyL", true);
    else { sendKey("KeyJ", false); sendKey("KeyL", false); }

    if (axes[3] < -0.5) sendKey("KeyI", true);
    else if (axes[3] > 0.5) sendKey("KeyK", true);
    else { sendKey("KeyI", false); sendKey("KeyK", false); }
  }

  // Track pressed state to avoid spamming events
  const pressed = {};

  function sendKey(code, down) {
    if (pressed[code] === down) return;
    pressed[code] = down;
    const evt = new KeyboardEvent(down ? "keydown" : "keyup", { code, key: code });
    document.dispatchEvent(evt);
  }

  function pollGamepads() {
    const pads = navigator.getGamepads();
    for (const pad of pads) {
      if (!pad) continue;

      // Buttons
      pad.buttons.forEach((btn, i) => {
        if (keyMap[i]) sendKey(keyMap[i], btn.pressed);
      });

      // Axes
      handleAxes(pad.axes);
    }
    requestAnimationFrame(pollGamepads);
  }

  window.addEventListener("gamepadconnected", () => {
    console.log("Gamepad connected");
    pollGamepads();
  });
});
</script>
  </body>
</html>
