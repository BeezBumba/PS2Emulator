<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <link rel="icon" href="/favicon.ico"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="description" content="A PlayStation2 emulator for web browsers"/>
    <link rel="apple-touch-icon" href="/play-192.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <title>Play!.js</title>
    <script defer src="/static/js/main.caabe80b.js"></script>
    <script defer src="/register.js"></script>
    <link href="/static/css/main.5a525eca.css" rel="stylesheet">
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #000; /* matches theme */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .canvas-wrapper {
        position: relative;
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #000;
        overflow: hidden; /* ensures no accidental scrollbars */
      }

      .canvas-wrapper canvas {
        width: 90vw;   /* slightly smaller than full width */
        height: 90vh;  /* slightly smaller than full height */
        object-fit: contain; /* preserves aspect ratio */
        display: block;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div class="global-row">
      <div class="global-column">
        <div class="canvas-wrapper">
          <canvas id="outputCanvas" width="640" height="480" tabindex="-1"></canvas>
        </div>
        <div id="root"></div>
      </div>
    </div>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const canvas = document.getElementById("outputCanvas");

  // Core bridge: same as mobile controls overlay
  function s(e, type) {
    let code = "";
    if (e.length === 1) code = "Key" + e.toUpperCase();
    else if (e === "Enter") code = "Enter";
    else if (e === "Backspace") code = "Backspace";
    else if (e.startsWith("Arrow")) code = e;
    else if (["1","2","3","8","9","0"].includes(e)) code = "Digit" + e;

    const evt = new KeyboardEvent(type, {
      key: e,
      code: code,
      bubbles: true,
      cancelable: true,
      isTrusted: true
    });

    if (canvas) canvas.dispatchEvent(evt);
    window.dispatchEvent(evt);
    document.dispatchEvent(evt);
  }

  // Track pressed state so we don't spam events
  const pressed = {};

  function sendKey(key, down) {
    if (pressed[key] === down) return;
    pressed[key] = down;
    s(key, down ? "keydown" : "keyup");
  }

  function handleGamepad(pad) {
    // Face buttons
    sendKey("Z", pad.buttons[0].pressed); // Cross (A)
    sendKey("X", pad.buttons[1].pressed); // Circle (B)
    sendKey("A", pad.buttons[2].pressed); // Square (X)
    sendKey("S", pad.buttons[3].pressed); // Triangle (Y)

    // D-Pad
    sendKey("ArrowUp", pad.buttons[12].pressed);
    sendKey("ArrowDown", pad.buttons[13].pressed);
    sendKey("ArrowLeft", pad.buttons[14].pressed);
    sendKey("ArrowRight", pad.buttons[15].pressed);

    // Start / Select
    sendKey("Enter", pad.buttons[9].pressed);
    sendKey("Backspace", pad.buttons[8].pressed);

    // Shoulders / Triggers
    sendKey("1", pad.buttons[4].pressed);  // L1
    sendKey("2", pad.buttons[6].pressed);  // L2
    sendKey("3", pad.buttons[10].pressed); // L3
    sendKey("8", pad.buttons[5].pressed);  // R1
    sendKey("9", pad.buttons[7].pressed);  // R2
    sendKey("0", pad.buttons[11].pressed); // R3

    // Left stick → F/H/T/G
    sendKey("f", pad.axes[0] < -0.5);
    sendKey("h", pad.axes[0] > 0.5);
    sendKey("t", pad.axes[1] < -0.5);
    sendKey("g", pad.axes[1] > 0.5);

    // Right stick → J/L/I/K
    sendKey("j", pad.axes[2] < -0.5);
    sendKey("l", pad.axes[2] > 0.5);
    sendKey("i", pad.axes[3] < -0.5);
    sendKey("k", pad.axes[3] > 0.5);
  }

  function pollGamepads() {
    const pads = navigator.getGamepads();
    for (const pad of pads) {
      if (pad) handleGamepad(pad);
    }
    requestAnimationFrame(pollGamepads);
  }

  window.addEventListener("gamepadconnected", (e) => {
    console.log("Gamepad connected:", e.gamepad.id);
    pollGamepads();
  });
});
</script>
  </body>
</html>
