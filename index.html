<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <link rel="icon" href="/favicon.ico"/>
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,orientation=landscape"/>
        <meta name="theme-color" content="#000000"/>
        <meta name="description" content="A PlayStation2 emulator for web browsers"/>
        <meta name="google-adsense-account" content="ca-pub-6468293492439852">
        <link rel="apple-touch-icon" href="/play-192.png"/>
        <link rel="manifest" href="/manifest.json"/>
        <title>Play!.js</title>
       
        <style>
            @media screen and (orientation: portrait) {
                #orientation-warning {
                    display:flex!important
                }

                #mobile-controls {
                    display: none!important
                }
            }

            #orientation-warning {
                display: none;
                position: fixed;
                left: 0;
                top: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0,0,0,.85);
                color: #fff;
                z-index: 3000;
                align-items: center;
                justify-content: center;
                text-align: center;
                font-size: 2em;
                padding: 2em
            }

            body {
                user-select: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                margin: 0;
                padding: 0;
                width: 100vw;
                height: 100vh;
                overflow: hidden;
                background: #000;
            }

            /* FIXED: React file input positioning - collapsible at top */
            #root {
                position: fixed;
                top: 0;
                left: 50%;
                transform: translateX(-50%);
                z-index: 10;
                pointer-events: auto;
            }

            /* File import toggle button */
            #file-import-toggle {
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 11;
                background: #333;
                color: #fff;
                border: none;
                border-radius: 6px;
                padding: 8px 12px;
                cursor: pointer;
                font-size: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                transition: background 0.2s;
            }

            #file-import-toggle:hover {
                background: #444;
            }

            /* Settings toggle button */
            #settings-toggle {
                position: fixed;
                top: 20px;
                left: 120px;
                z-index: 11;
                background: #333;
                color: #fff;
                border: none;
                border-radius: 6px;
                padding: 8px 12px;
                cursor: pointer;
                font-size: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                transition: background 0.2s;
            }

            #settings-toggle:hover {
                background: #444;
            }

            /* Settings panel */
            #settings-panel {
                position: fixed;
                top: 60px;
                left: 120px;
                z-index: 10;
                background: rgba(0, 0, 0, 0.95);
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
                border: 1px solid #444;
                transform: translateY(-100%);
                opacity: 0;
                transition: all 0.3s ease;
                pointer-events: none;
                min-width: 200px;
            }

            #settings-panel.expanded {
                transform: translateY(0);
                opacity: 1;
                pointer-events: auto;
            }

            #settings-panel label {
                display: block;
                color: #fff;
                font-weight: bold;
                margin-bottom: 8px;
                font-size: 14px;
            }

            #settings-panel select {
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #666;
                border-radius: 4px;
                background-color: #444;
                color: #fff;
                font-size: 14px;
                cursor: pointer;
                font-family: inherit;
            }

            #settings-panel select:hover {
                background-color: #555;
                border-color: #777;
            }

            #settings-panel select:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
            }

            /* Collapsible file import panel */
            #root > div {
                background: rgba(0, 0, 0, 0.95);
                padding: 12px 16px;
                border-radius: 0 0 8px 8px;
                display: flex;
                align-items: center;
                gap: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
                border: 1px solid #444;
                border-top: none;
                transform: translateY(-100%);
                transition: transform 0.3s ease;
                min-width: 300px;
                justify-content: center;
            }

            #root.expanded > div {
                transform: translateY(0);
            }

            #root input[type="file"] {
                background: #444;
                color: #fff;
                border: 1px solid #666;
                border-radius: 4px;
                padding: 6px 10px;
                font-size: 14px;
                cursor: pointer;
                font-family: inherit;
            }

            #root input[type="file"]::-webkit-file-upload-button {
                background: #555;
                color: #fff;
                border: none;
                border-radius: 3px;
                padding: 4px 8px;
                margin-right: 8px;
                cursor: pointer;
                font-size: 12px;
            }

            #root input[type="file"]:hover {
                background: #555;
                border-color: #777;
            }

            #root .stats, #root .version {
                color: #ccc;
                font-size: 12px;
                font-family: monospace;
                white-space: nowrap;
            }

            #root .stats {
                color: #4CAF50;
            }

            #root .version {
                color: #2196F3;
            }

            #outputCanvas {
                display: block;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%,-50%);
                background: #000;
                z-index: 1;
                width: 100vw;
                height: 56.25vw;
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0
            }

            @media (max-width: 900px) and (orientation:landscape) {
                #outputCanvas {
                    width:100vw;
                    height: 56.25vw;
                    max-height: 100vh;
                    max-width: 100vw
                }
            }

            @media (max-width: 900px) and (orientation:portrait) {
                #outputCanvas {
                    width:100vw;
                    height: 100vw;
                    max-height: 100vh;
                    max-width: 100vw
                }
            }

            /* Touch controls toggle button */
            #touch-controls-toggle {
                position: fixed;
                top: 32px;
                right: 0;
                z-index: 2001;
                background: #222;
                color: #fff;
                border: none;
                border-radius: 8px 0 0 8px;
                box-shadow: 0 2px 8px #0004;
                padding: 8px 12px;
                cursor: pointer;
                transition: right .3s;
                font-size: 1.2em;
            }

            /* Touch controls visibility - FIXED: Complete transparency and disabled interaction */
            #mobile-controls.hidden {
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
            }

            .mc-actions button:active,.mc-center-buttons button:active,.mc-dpad button:active,.mc-joystick .thumbstick:active,.mc-shoulder-left button:active,.mc-shoulder-right button:active {
                filter: brightness(1.5) drop-shadow(0 0 8px #fff8);
                outline: 2px solid #fff;
                box-shadow: 0 0 16px #fff8
            }

            .mc-actions button.pressed,.mc-center-buttons button.pressed,.mc-dpad button.pressed,.mc-joystick .thumbstick.pressed,.mc-shoulder-left button.pressed,.mc-shoulder-right button.pressed {
                filter: brightness(1.5) drop-shadow(0 0 8px #fff8);
                outline: 2px solid #fff;
                box-shadow: 0 0 16px #fff8
            }

            #mobile-controls {
                position: fixed;
                left: 0;
                bottom: 0;
                width: 100vw;
                height: auto;
                pointer-events: none;
                z-index: 1000;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
                align-items: center
            }

            .mc-grid-container {
                display: flex;
                justify-content: space-between;
                align-items: flex-end;
                width: 100%;
                padding: 0 3vw 2vh
            }

            .mc-left-column,.mc-right-column {
                display: flex;
                flex-direction: row;
                align-items: flex-end;
                gap: 20px;
                pointer-events: auto
            }

            .mc-center-buttons {
                pointer-events: auto;
                display: flex;
                align-items: center;
                gap: 16px;
                margin-bottom: 16px
            }

            .mc-center-buttons button {
                border-radius: 8px;
                padding: 8px 12px;
                font-size: .9em;
                background: #34495e;
                color: #fff;
                border: none;
                box-shadow: 0 2px 8px #0004
            }

            .mc-dpad {
                width: 160px;
                height: 160px;
                display: grid;
                grid-template-areas: ". up ." "left center right" ". down .";
                grid-template-columns: 1fr 1fr 1fr;
                grid-template-rows: 1fr 1fr 1fr;
                gap: 8px
            }

            .mc-dpad button {
                border-radius: 50%;
                width: 48px;
                height: 48px;
                font-size: 1.5em;
                background: #222;
                color: #fff;
                border: none;
                box-shadow: 0 2px 8px #0004;
            }

            .mc-dpad .up {
                grid-area: up;
            }

            .mc-dpad .down {
                grid-area: down;
            }

            .mc-dpad .left {
                grid-area: left;
            }

            .mc-dpad .right {
                grid-area: right;
            }

            .mc-dpad .center {
                grid-area: center;
                opacity: 0
            }

            .mc-actions {
                width: 180px;
                height: 200px;
                display: grid;
                grid-template-areas: 
                    ". . triangle . ."
                    ". square . circle ."
                    ". . cross . ."
                    ". . . . .";
                grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
                grid-template-rows: 1fr 1fr 1fr 1fr;
                gap: 4px;
                align-items: center;
                justify-items: center;
            }

            .mc-actions button {
                border-radius: 50%;
                width: 54px;
                height: 54px;
                font-size: 1.2em;
                border: none;
                box-shadow: 0 2px 8px #0004
            }

            .mc-actions .triangle {
                grid-area: triangle;
                background: #333;
                color: #3ee3a1;
                border: 2px solid #555;
            }

            .mc-actions .square {
                grid-area: square;
                background: #333;
                color: #ff69f8;
                border: 2px solid #555;
            }

            .mc-actions .cross {
                grid-area: cross;
                background: #333;
                color: #7db3e9;
                border: 2px solid #555;
            }

            .mc-actions .circle {
                grid-area: circle;
                background: #333;
                color: #ff6666;
                border: 2px solid #555;
            }

            .mc-shoulder-left,.mc-shoulder-right {
                display: flex;
                flex-direction: column;
                gap: 8px
            }

            .mc-shoulder-left button,.mc-shoulder-right button {
                border-radius: 8px;
                padding: 8px 12px;
                font-size: .9em;
                background: #34495e;
                color: #fff;
                border: none;
                box-shadow: 0 2px 8px #0004
            }

            .mc-joystick {
                width: 120px;
                height: 120px;
                background: rgba(34,34,34,.5);
                border-radius: 50%;
                position: relative;
                box-shadow: 0 2px 8px #0004;
                user-select: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none
            }

            .mc-joystick .thumbstick {
                width: 60px;
                height: 60px;
                background: #ddd;
                border-radius: 50%;
                box-shadow: inset 0 2px 4px #0004,0 1px 2px #fff8;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%,-50%);
                touch-action: none;
                user-select: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none
            }
        </style>
        <script defer="defer" src="/static/js/main.8bf5d625.js"></script>
        <script defer src="/register.js"></script>
        <link href="/static/css/main.5a525eca.css" rel="stylesheet">
    </head>
    <body>
        <noscript>You need to enable JavaScript to run this app.</noscript>
        <div class="global-row">
            <div class="global-column">
                <div>
                    <canvas id="outputCanvas" width="640" height="480" tabindex="-1"/>
                    <div style="margin:16px 0">
                        <label for="main-file-input" style="font-weight:700;display:block;margin-bottom:8px">Choose a game file:</label>
                        <input type="file" id="main-file-input" style="width:100%;max-width:320px"/>
                    </div>
                </div>
                <button id="touch-controls-toggle" aria-label="Toggle touch controls">
                    🎮
                </button>
                <button id="file-import-toggle" aria-label="Toggle file import">
                    📁
                </button>
                <button id="settings-toggle" aria-label="Settings">
                    🔧
                </button>
                <div id="settings-panel">
                    <label for="resolution-select">Resolution Scale:</label>
                    <select id="resolution-select">
                        <option value="1">1x (640×480)</option>
                        <option value="2">2x (1280×960)</option>
                        <option value="3">3x (1920×1440)</option>
                    </select>
                </div>
                <div id="root"></div>
                <div id="mobile-controls">
                    <div class="mc-grid-container">
                        <div class="mc-left-column">
                            <div class="mc-shoulder-left">
                                <button data-key="1">L1</button>
                                <button data-key="2">L2</button>
                                <button data-key="3">L3</button>
                            </div>
                            <div class="mc-left-side-stack">
                                <div class="mc-dpad">
                                    <button class="up" data-key="ArrowUp">▲</button>
                                    <button class="left" data-key="ArrowLeft">◀</button>
                                    <button class="center" tabindex="-1"></button>
                                    <button class="right" data-key="ArrowRight">▶</button>
                                    <button class="down" data-key="ArrowDown">▼</button>
                                </div>
                                <div id="left-joystick" class="mc-joystick">
                                    <div class="thumbstick"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mc-center-buttons">
                            <button data-key="Backspace">SELECT</button>
                            <button data-key="Enter">START</button>
                        </div>
                        <div class="mc-right-column">
                            <div class="mc-right-side-stack">
                                <div class="mc-actions">
                                    <button class="cross" data-key="Z">✕</button>
                                    <button class="square" data-key="A">□</button>
                                    <button class="triangle" data-key="S">△</button>
                                    <button class="circle" data-key="X">◯</button>
                                </div>
                                <div id="right-joystick" class="mc-joystick">
                                    <div class="thumbstick"></div>
                                </div>
                            </div>
                            <div class="mc-shoulder-right">
                                <button data-key="8">R1</button>
                                <button data-key="9">R2</button>
                                <button data-key="0">R3</button>
                            </div>
                        </div>
                    </div>
                </div>
           
                <div id="orientation-warning">
                    <div>
                        <div style="font-size:3em;margin-bottom:0.5em">📱</div>
                        <div>Please rotate your device to landscape mode for the best gaming experience</div>
                    </div>
                </div>

                <script>
                    document.addEventListener("DOMContentLoaded", (function() {
                        // Mobile controls functionality
                        const mobileControls = document.getElementById("mobile-controls");
                        const touchControlsToggle = document.getElementById("touch-controls-toggle");
                        
                        let controlsVisible = false;
                        
                        function toggleTouchControls() {
                            controlsVisible = !controlsVisible;
                            if (controlsVisible) {
                                mobileControls.classList.remove('hidden');
                                touchControlsToggle.style.right = '0';
                            } else {
                                mobileControls.classList.add('hidden');
                                touchControlsToggle.style.right = '-10px';
                            }
                        }
                        
                        // Initially hide controls
                        mobileControls.classList.add('hidden');
                        touchControlsToggle.style.right = '-10px';
                        
                        touchControlsToggle.addEventListener('click', toggleTouchControls);

                        // File import functionality
                        const rootDiv = document.getElementById("root");
                        const fileImportToggle = document.getElementById("file-import-toggle");
                        
                        function toggleFileImport() {
                            rootDiv.classList.toggle('expanded');
                        }
                        
                        fileImportToggle.addEventListener('click', toggleFileImport);

                        // Settings panel functionality
                        const settingsToggle = document.getElementById("settings-toggle");
                        const settingsPanel = document.getElementById("settings-panel");
                        const resolutionSelect = document.getElementById("resolution-select");

                        settingsToggle.addEventListener('click', function() {
                            settingsPanel.classList.toggle('expanded');
                        });

                        resolutionSelect.addEventListener('change', function(e) {
                            const newScale = parseInt(e.target.value);
                            
                            // Wait for React app to be ready
                            setTimeout(() => {
                                if (window.PlayModule && window.PlayModule.setResolutionScale) {
                                    window.PlayModule.setResolutionScale(newScale);
                                    console.log('Resolution set to:', newScale + 'x');
                                }
                            }, 100);
                            
                            // Auto-hide panel
                            setTimeout(() => {
                                settingsPanel.classList.remove('expanded');
                            }, 1000);
                        });

                        // Auto-hide file import panel after file selection
                        const observer = new MutationObserver(function(mutations) {
                            mutations.forEach(function(mutation) {
                                if (mutation.type === 'childList' && rootDiv.children.length > 0) {
                                    const fileInput = rootDiv.querySelector('input[type="file"]');
                                    if (fileInput) {
                                        fileInput.addEventListener('change', function() {
                                            if (this.files.length > 0) {
                                                setTimeout(() => {
                                                    rootDiv.classList.remove('expanded');
                                                }, 1000);
                                            }
                                        });
                                    }
                                }
                            });
                        });

                        observer.observe(rootDiv, { childList: true, subtree: true });

                        // COPIED EXACT BUTTON LOGIC FROM WORKING FILE
                        const i = document.getElementById("outputCanvas");
                        function d(e, t="Message") {
                            const n = `\n                  <div id="custom-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; justify-content: center; align-items: center;">\n                      <div style="background: white; padding: 20px; border-radius: 10px; text-align: center; max-width: 80%; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">\n                          <h3 style="margin-top: 0;">${t}</h3>\n                          <p>${e}</p>\n                          <button id="close-modal" style="padding: 8px 16px; margin-top: 10px; border: none; border-radius: 5px; background: #3498db; color: white; cursor: pointer;">OK</button>\n                      </div>\n                  </div>\n              `;
                            document.body.insertAdjacentHTML("beforeend", n),
                            document.getElementById("close-modal").addEventListener("click", ( () => {
                                document.getElementById("custom-modal").remove()
                            }
                            ))
                        }
                        function s(e, t) {
                            // FIXED: Don't dispatch events if controls are hidden
                            if (mobileControls.classList.contains('hidden')) {
                                return;
                            }
                            
                            let n = "";
                            1 === e.length ? n = "Key" + e.toUpperCase() : "Enter" === e ? n = "Enter" : "Backspace" === e ? n = "Backspace" : e.startsWith("Arrow") ? n = e : ["1", "2", "3", "8", "9", "0"].includes(e) && (n = "Digit" + e);
                            const o = new KeyboardEvent(t,{
                                key: e,
                                code: n,
                                bubbles: !0,
                                cancelable: !0,
                                isTrusted: !0
                            });
                            i && i.dispatchEvent(o),
                            window.dispatchEvent(o),
                            document.dispatchEvent(o)
                        }
                        function c(e, t) {
                            // FIXED: Don't add pressed class or dispatch events if controls are hidden
                            if (mobileControls.classList.contains('hidden')) {
                                return;
                            }
                            
                            e.classList.add("pressed"),
                            s(t, "keydown"),
                            console.log(`Keydown event dispatched for: ${t}`)
                        }
                        function a(e, t) {
                            // FIXED: Don't remove pressed class or dispatch events if controls are hidden
                            if (mobileControls.classList.contains('hidden')) {
                                return;
                            }
                            
                            e.classList.remove("pressed"),
                            s(t, "keyup"),
                            console.log(`Keyup event dispatched for: ${t}`)
                        }
                        document.querySelectorAll("#mobile-controls button[data-key]").forEach((function(e) {
                            const t = e.getAttribute("data-key");
                            e.addEventListener("touchstart", (function(n) {
                                n.preventDefault(),
                                c(e, t)
                            }
                            )),
                            e.addEventListener("mousedown", (function(n) {
                                n.preventDefault(),
                                c(e, t)
                            }
                            )),
                            e.addEventListener("touchend", (function(n) {
                                n.preventDefault(),
                                a(e, t)
                            }
                            )),
                            e.addEventListener("mouseup", (function(n) {
                                n.preventDefault(),
                                a(e, t)
                            }
                            )),
                            e.addEventListener("mouseleave", (function(n) {
                                1 === n.buttons && a(e, t)
                            }
                            ))
                        }
                        ));
                        const l = document.getElementById("left-joystick")
                          , r = l.querySelector(".thumbstick")
                          , u = document.getElementById("right-joystick")
                          , f = u.querySelector(".thumbstick")
                          , m = {
                            up: "t",
                            down: "g",
                            left: "f",
                            right: "h"
                        }
                          , p = {
                            up: "i",
                            down: "k",
                            left: "j",
                            right: "l"
                        };
                        let g = new Set
                          , h = new Set
                          , v = !1
                          , y = !1;
                        function E(e, t, n, o, i, d) {
                            // FIXED: Don't update joystick if controls are hidden
                            if (mobileControls.classList.contains('hidden')) {
                                return;
                            }
                            
                            const c = e.getBoundingClientRect();
                            let a = n - (c.left + c.width / 2)
                              , l = o - (c.top + c.height / 2);
                            const r = Math.sqrt(a * a + l * l);
                            r > 30 && (a = a / r * 30,
                            l = l / r * 30),
                            t.style.transform = `translate(calc(-50% + ${a}px), calc(-50% + ${l}px))`,
                            t.classList.add("pressed");
                            const u = new Set;
                            l < -15 && u.add(i.up),
                            l > 15 && u.add(i.down),
                            a < -15 && u.add(i.left),
                            a > 15 && u.add(i.right),
                            u.forEach((e => {
                                d.has(e) || (s(e, "keydown"),
                                d.add(e))
                            }
                            )),
                            d.forEach((e => {
                                u.has(e) || (s(e, "keyup"),
                                d.delete(e))
                            }
                            ))
                        }
                        function w(e, t) {
                            e.style.transform = "translate(-50%, -50%)",
                            e.classList.remove("pressed"),
                            t.forEach((e => {
                                s(e, "keyup")
                            }
                            )),
                            t.clear()
                        }
                        l.addEventListener("mousedown", (e => {
                            e.preventDefault(),
                            v = !0,
                            E(l, r, e.clientX, e.clientY, m, g)
                        }
                        )),
                        l.addEventListener("touchstart", (e => {
                            e.preventDefault(),
                            v = !0;
                            const t = e.touches[0];
                            E(l, r, t.clientX, t.clientY, m, g)
                        }
                        ), !1),
                        u.addEventListener("mousedown", (e => {
                            e.preventDefault(),
                            y = !0,
                            E(u, f, e.clientX, e.clientY, p, h)
                        }
                        )),
                        u.addEventListener("touchstart", (e => {
                            e.preventDefault(),
                            y = !0;
                            const t = e.touches[0];
                            E(u, f, t.clientX, t.clientY, p, h)
                        }
                        ), !1),
                        window.addEventListener("mousemove", (e => {
                            v && E(l, r, e.clientX, e.clientY, m, g),
                            y && E(u, f, e.clientX, e.clientY, p, h)
                        }
                        )),
                        window.addEventListener("touchmove", (e => {
                            if (v) {
                                const t = Array.from(e.touches).find((e => e.target.closest("#left-joystick")));
                                t && E(l, r, t.clientX, t.clientY, m, g)
                            }
                            if (y) {
                                const t = Array.from(e.touches).find((e => e.target.closest("#right-joystick")));
                                t && E(u, f, t.clientX, t.clientY, p, h)
                            }
                        }
                        )),
                        window.addEventListener("mouseup", ( () => {
                            v && (v = !1,
                            w(r, g)),
                            y && (y = !1,
                            w(f, h))
                        }
                        )),
                        window.addEventListener("touchend", (e => {
                            v && (Array.from(e.touches).some((e => e.target.closest("#left-joystick"))) || (v = !1,
                            w(r, g))),
                            y && (Array.from(e.touches).some((e => e.target.closest("#right-joystick"))) || (y = !1,
                            w(f, h)))
                        }
                        ))

                        // GAMEPAD FUNCTIONALITY ADDED
                        // Track pressed state so we don't spam events
                        const gamepadPressed = {};

                        function sendGamepadKey(key, down) {
                            if (gamepadPressed[key] === down) return;
                            gamepadPressed[key] = down;
                            
                            // FIXED: Gamepad should work independently of mobile controls visibility
                            let code = "";
                            if (key.length === 1) code = "Key" + key.toUpperCase();
                            else if (key === "Enter") code = "Enter";
                            else if (key === "Backspace") code = "Backspace";
                            else if (key.startsWith("Arrow")) code = key;
                            else if (["1","2","3","8","9","0"].includes(key)) code = "Digit" + key;

                            const evt = new KeyboardEvent(down ? "keydown" : "keyup", {
                                key: key,
                                code: code,
                                bubbles: true,
                                cancelable: true,
                                isTrusted: true
                            });

                            if (i) i.dispatchEvent(evt);
                            window.dispatchEvent(evt);
                            document.dispatchEvent(evt);
                        }

                        function handleGamepad(pad) {
                            // Face buttons
                            sendGamepadKey("Z", pad.buttons[0].pressed); // Cross (A)
                            sendGamepadKey("X", pad.buttons[1].pressed); // Circle (B)
                            sendGamepadKey("A", pad.buttons[2].pressed); // Square (X)
                            sendGamepadKey("S", pad.buttons[3].pressed); // Triangle (Y)

                            // D-Pad
                            sendGamepadKey("ArrowUp", pad.buttons[12].pressed);
                            sendGamepadKey("ArrowDown", pad.buttons[13].pressed);
                            sendGamepadKey("ArrowLeft", pad.buttons[14].pressed);
                            sendGamepadKey("ArrowRight", pad.buttons[15].pressed);

                            // Start / Select
                            sendGamepadKey("Enter", pad.buttons[9].pressed);
                            sendGamepadKey("Backspace", pad.buttons[8].pressed);

                            // Shoulders / Triggers
                            sendGamepadKey("1", pad.buttons[4].pressed);  // L1
                            sendGamepadKey("2", pad.buttons[6].pressed);  // L2
                            sendGamepadKey("3", pad.buttons[10].pressed); // L3
                            sendGamepadKey("8", pad.buttons[5].pressed);  // R1
                            sendGamepadKey("9", pad.buttons[7].pressed);  // R2
                            sendGamepadKey("0", pad.buttons[11].pressed); // R3

                            // Left stick → F/H/T/G
                            sendGamepadKey("f", pad.axes[0] < -0.5);
                            sendGamepadKey("h", pad.axes[0] > 0.5);
                            sendGamepadKey("t", pad.axes[1] < -0.5);
                            sendGamepadKey("g", pad.axes[1] > 0.5);

                            // Right stick → J/L/I/K
                            sendGamepadKey("j", pad.axes[2] < -0.5);
                            sendGamepadKey("l", pad.axes[2] > 0.5);
                            sendGamepadKey("i", pad.axes[3] < -0.5);
                            sendGamepadKey("k", pad.axes[3] > 0.5);
                        }

                        function pollGamepads() {
                            const pads = navigator.getGamepads();
                            for (const pad of pads) {
                                if (pad) handleGamepad(pad);
                            }
                            requestAnimationFrame(pollGamepads);
                        }

                        window.addEventListener("gamepadconnected", (e) => {
                            console.log("Gamepad connected:", e.gamepad.id);
                            pollGamepads();
                        });

                        window.addEventListener("gamepaddisconnected", (e) => {
                            console.log("Gamepad disconnected:", e.gamepad.id);
                        });
                    }))
                </script>
            </div>
            <div class="global-column" style="max-width:500px;overflow:auto">
                <div></div>
            </div>
        </div>
    </body>
</html>
